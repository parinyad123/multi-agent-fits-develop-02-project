‡∏£‡∏∞‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πâ PostgreSQL ‡πÅ‡∏•‡∏∞‡∏°‡∏µ 6 tables ‡∏´‡∏•‡∏±‡∏Å ‡∏ó‡∏µ‡πà‡∏≠‡∏≠‡∏Å‡πÅ‡∏ö‡∏ö‡∏°‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö multi-user, multi-session analysis workflow:

üìä Tables ‡πÅ‡∏•‡∏∞ Relationships
users (1) ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ> (N) fits_files
            ‚îú‚îÄ‚îÄ> (N) sessions  
            ‚îî‚îÄ‚îÄ> (N) analysis_history

fits_files (1) ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ> (N) file_sessions
                 ‚îú‚îÄ‚îÄ> (N) analysis_history
                 ‚îî‚îÄ‚îÄ> (N) plot_files

sessions (1) ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ> (N) file_sessions
               ‚îî‚îÄ‚îÄ> (N) analysis_history

analysis_history (1) ‚îÄ‚îÄ> (N) plot_files

============ 1. users Table - User Management ============
‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞ preferences
---------------------------------------------------------------------------
Column          Type                    Description
---------------------------------------------------------------------------
user_id         UUID (PK)               Primary key, auto-generated
username        String(100), unique     Username (optional)
email           String(255), unique     Email address (optional)
preferences     JSONB                   User preferences (JSON format)
created_at      DateTime(TZ)            Account creation timestamp
last_login_at   DateTime(TZ)            Last login timestamp
---------------------------------------------------------------------------

Indexes:

idx_user_username on username
idx_user_email on email

Relationships:

fits_files (1:N) - ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà user ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
sessions (1:N) - sessions ‡∏Ç‡∏≠‡∏á user
analyses (1:N) - analysis history ‡∏Ç‡∏≠‡∏á user


============ 2. fits_files Table - FITS File Storage ============
‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• metadata ‡∏Ç‡∏≠‡∏á FITS files ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î

---------------------------------------------------------------------------
Column              Type                    Description
---------------------------------------------------------------------------
file_id             UUID (PK)               Primary key, auto-generated
user_id             UUID (FK)               ‚Üí users.user_id, CASCADE DELETE
original_filename   String(255)             ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö
metadata_filename   String(255)             ‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å FITS header (optional)
file_size           BigInteger              ‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏ü‡∏•‡πå (bytes), must be > 0
storage_path        String(500), unique     Path ‡∏ö‡∏ô filesystem
is_valid            Boolean                 ‡πÑ‡∏ü‡∏•‡πå valid ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
validation_status   String(50)              'pending', 'valid', 'invalid', 'corrupted'
validation_error    Text                    Error message ‡∏ñ‡πâ‡∏≤ validation fail
uploaded_at         DateTime(TZ)            ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î
last_accessed_at    DateTime(TZ)            ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (auto-update)
fits_metadata       JSONB                   FITS header metadata
data_info           JSONB                   ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• HDU structure, columns, etc.
---------------------------------------------------------------------------

Constraints:

CHECK (file_size > 0)

Indexes:

idx_fits_user_id on user_id
idx_fits_uploaded_at on uploaded_at
idx_fits_last_accessed on last_accessed_at
idx_fits_validation_status on validation_status
idx_fits_is_valid on is_valid

Relationships:

user (N:1) - ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÑ‡∏ü‡∏•‡πå
file_sessions (1:N) - sessions ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ
analyses (1:N) - analysis ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ
plots (1:N) - plots ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ


============ 3. sessions Table - Chat/Analysis Sessions ============
‡πÄ‡∏Å‡πá‡∏ö session context ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ chat/analysis page
---------------------------------------------------------------------------
Column              Type                Description
---------------------------------------------------------------------------
session_id          UUID (PK)           Primary key, auto-generated
user_id             UUID (FK)           ‚Üí users.user_id, CASCADE DELETE
created_at          DateTime(TZ)        ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á session
last_activity_at    DateTime(TZ)        ‡πÄ‡∏ß‡∏•‡∏≤ activity ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (auto-update)
expires_at          DateTime(TZ)‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà   session ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏
is_active           Boolean             Session active ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
current_file_id     UUID (FK)           ‚Üí fits_files.file_id, SET NULL on delete
session_metadata    JSONB               Context, conversation history, etc.
---------------------------------------------------------------------------
Indexes:

idx_session_user_id on user_id
idx_session_last_activity on last_activity_at
idx_session_is_active on is_active

Relationships:

user (N:1) - ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á session
current_file (N:1) - ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏¢‡∏π‡πà
file_sessions (1:N) - ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô session
analyses (1:N) - analysis ‡πÉ‡∏ô session ‡∏ô‡∏µ‡πâ


============ 4. file_sessions Table - Junction Table ============
‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏° FITS files ‡∏Å‡∏±‡∏ö sessions (Many-to-Many relationship)
---------------------------------------------------------------------------
Column              Type                Description
---------------------------------------------------------------------------
id                  Integer (PK)        Auto-increment primary key
file_id             UUID (FK)           ‚Üí fits_files.file_id, CASCADE DELETE
session_id          UUID (FK)           ‚Üí sessions.session_id, CASCADE DELETE
added_atDate        Time(TZ)            ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏Ç‡πâ‡∏≤ session
last_used_at        DateTime(TZ)        ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (auto-update)
usage_count         Integer             ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô session
is_primary          Boolean             ‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á session ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
analysis_context    JSONB               Context ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå‡∏ô‡∏µ‡πâ‡πÉ‡∏ô session
---------------------------------------------------------------------------
Indexes:

idx_file_session_file_id on file_id
idx_file_session_session_id on session_id
idx_file_session_unique on (file_id, session_id) - UNIQUE constraint

Relationships:

fits_file (N:1) - ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°
session (N:1) - session ‡∏ó‡∏µ‡πà‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°


============ 5. analysis_history Table - Analysis Results ============
‡πÄ‡∏Å‡πá‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£ analysis
---------------------------------------------------------------------------
Column                  Type            Description
---------------------------------------------------------------------------
analysis_id             UUID (PK)       Primary key, auto-generated
file_id                 UUID (FK)       ‚Üí fits_files.file_id, CASCADE DELETE
session_id              UUID (FK)       ‚Üí sessions.session_id, CASCADE DELETE
user_id                 UUID (FK)       ‚Üí users.user_id, CASCADE DELETE
analysis_types          Array[String]   ['statistics', 'psd', 'power_law']
parameters              JSONB           Parameters ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ analysis
results                 JSONB           ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏Å‡∏≤‡∏£ analysis
workflow_id             UUID            ID ‡∏Ç‡∏≠‡∏á workflow (from orchestrator)
status                  String(50)      'pending', 'running', 'completed', 'failed'
execution_time_seconds  BigInteger      ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏• (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)
started_at              DateTime(TZ)    ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô analysis
completed_atDate        Time(TZ)        ‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô analysis
---------------------------------------------------------------------------
Indexes:

idx_analysis_file_id on file_id
idx_analysis_session_id on session_id
idx_analysis_user_id on user_id
idx_analysis_started_at on started_at
idx_analysis_status on status

Relationships:

fits_file (N:1) - ‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
session (N:1) - session ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
user (N:1) - ‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
plots (1:N) - plots ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ô‡∏µ‡πâ


============ 6. plot_files Table - Generated Plots ============
‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• plots ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£ analysis
---------------------------------------------------------------------------
Column          Type            Description
---------------------------------------------------------------------------
plot_id         UUID (PK)       Primary key, auto-generated
analysis_id     UUID (FK)       ‚Üí analysis_history.analysis_id, CASCADE DELETE
file_id         UUID (FK)       ‚Üí fits_files.file_id, CASCADE DELETE
plot_type       String(50)      'psd', 'power_law', 'bending_power_law'
storage_path    String(500)     Path ‡∏ö‡∏ô filesystem
plot_url        String(500)     URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á plot
plot_metadata   JSONB           Parameters, dimensions, etc.
created_at      DateTime(TZ)    ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á plot
---------------------------------------------------------------------------
Indexes:

idx_plot_analysis_id on analysis_id
idx_plot_file_id on file_id
idx_plot_type on plot_type

Relationships:

analysis (N:1) - analysis ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á plot ‡∏ô‡∏µ‡πâ
fits_file (N:1) - ‡πÑ‡∏ü‡∏•‡πå‡∏ï‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á plot


================ Key Design Patterns ====================
1. Cascade Deletes
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö user ‚Üí ‡∏•‡∏ö fits_files, sessions, analyses ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö fits_file ‚Üí ‡∏•‡∏ö analyses, plots ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏•‡∏ö session ‚Üí ‡∏•‡∏ö analyses ‡πÉ‡∏ô session

2. JSONB Columns
‡πÉ‡∏ä‡πâ JSONB ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö flexible data:

preferences - user settings
fits_metadata - FITS header data
parameters - analysis parameters
results - analysis results
session_metadata - conversation context

3. Timestamps & Tracking
‡∏ó‡∏∏‡∏Å table ‡∏°‡∏µ timestamps ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö:

Creation time (created_at, uploaded_at)
Last activity (last_activity_at, last_accessed_at)
Auto-update on modification

4. Performance Indexes
Index ‡∏ö‡∏ô foreign keys ‡πÅ‡∏•‡∏∞ columns ‡∏ó‡∏µ‡πà query ‡∏ö‡πà‡∏≠‡∏¢:

User/session relationships
File access patterns
Analysis status queries